---
title: "[RUST] 러스트 프로그래밍 공식 가이드(제2판) 19장 요약"
description: 고급 기능
author: 김우석
date: 2025-10-31 08:00:00 +0900
categories: [Rust, OfficialGuide]
tags: [Rust]
image:
  path: /assets/img/posts/rust/rust-logo.svg
---

## 안전하지 않은 러스트

### 안전하지 않은 슈퍼파워
- 안전하지 않은 러스트로 전환하려면 unsafe 키워드를 사용해 다음 새 블록을 시작하여 안전하지 않은 코드를 집어넣음
- **안전하지 않은 슈퍼파워**라고 불리는 5가지 작업
  - 원시 포인터 역참조하기
  - 안전하지 않은 함수 혹은 메서드 호출하기
  - 가변 정적 변수에 접근하기 및 수정하기
  - 안전하지 않은 트레이트 구현하기
  - union의 필드 접근하기
- unsafe 키워드는 대여 검사기를 끄거나 러스트의 다른 안정성 검사를 비활성화 하는 것이 아니라 컴파일러가 메모리 안정성을 검사하지 않는 5가지 기능 허용만 제공

### 원시 포인터 역참조하기
- 원시포인터란, 참조자와 마찬가지로 불변 또는 가변이며 각각 `*const T` 와 `*mut T`로 작성됨 (`*`는 역참조 연산자가 아니라 타입 이름의 일부)
- 원시 포인터의 맥락에서 불변이란 포인터가 역참조된 후에 직접 할당할 수 없음을 의미
- 원시 포인터의 특징
  - 원시 포인터는 대여 규칙을 무시할 수 있으며, 같은 위치에 대해 불변과 가변 포인터를 동시에 가질 수 있거나 여러 개의 가변 포인터를 가질 수 있음
  - 원시 포인터는 유효한 메모리를 가리키는 것을 보장받지 못함
  - 원시 포인터는 널(null)이 될 수 있음
  - 원시 포인터는 자동 메모리 정리를 구현하지 않음
- 이러한 보증을 적용하지 않도록 선택하면, 안정성을 포기하는 대신 더 많은 기능이나 성능을 얻을 수 있음
- 원시 포인터 사용 사례
  - C 언어 코드와 상호작용할 때
  - 대여 검사기가 이해하지 못하는 안전한 추상화를 구축할 때

### 안전하지 않은 함수 또는 메서드 호출하기
- 안전하지 않은 함수와 메서드는 정의 앞에 unsafe 키워드가 추가되며, 함수를 호출할 때 지켜야 할 요구 사항이 있음을 나타냄
- unsafe 블록 내에서 안전하지 않은 함수를 호출한다는 것은 해당 함수의 설명서를 읽었고, 함수를 올바르게 사용하는 방법을 이해하며, 함수의 계약서를 이행하고 있음을 확인했다고 러스트에게 단언하는 것과 같음

### extern 함수를 사용하여 외부 코드 호출하기
- 러스트에서 다른 언어로 작성된 코드와 상호작용해야 할 경우 FFI(Foreign function interface)의 생성과 사용을 용이하게 하는 키워드 extern 을 사용함
  - FFI는 프로그래밍 언어가 함수를 정의하고 다른 외래 프로그래밍 언어가 해당 함수를 호출할 수 있도록 하는 방법
  - 사용 예시
    ```rust
    extern "C" { // 외부 함수가 사용하는 ABI(application binary interface)를 정의
    // 블록 내부에는 외부함수의 이름과 시그니처 나열
      fn abs(input: i32) -> i32; 
    }
    ```
- external 블록 내에 선언된 함수는 러스트 코드에서 호출되므로 안전하지않음
  - 다른 언어는 러스트의 규칙과 보증을 강제하지 않으니 러스트가 이를 확인할 수 없고, 안전을 보장할 책임을 모두 프로그래머가 져야 하기 때문

### 가변 정적 변수의 접근 혹은 수정하기
- 러스트에서 전역 변수는 정적 변수(static variable)라고 불리며, 정적 변수의 이름은 관례적으로 SCREAMING_SNAKE_CASE를 사용
- 정적 변수는 `'static` 라이프타임을 가진 참조자만 저장할 수 있으며, 이는 러스트 컴파일러가 라이프타임을 알아낼 수 있으므로 명시할 필요가 없음을 의미함
- 정적 변수는 가변일 수 있으며, 가변 정적 변수에 접근하고 수정하는 것은 안전하지 않음 (여러 스레트에서 가변 정적 변수에 수정할 수 있기 떄문에 안전하지 않은 것으로 간주)

### 안전하지 않은 트레이트 구현하기
- unsafe를 사용하여 안전하지 않은 트레이트를 구현할 수 있으며, 메서드 중 하나 이상에 컴파일러가 확인할 수 없는 불변성이 있는 경우 그 트레이트는 안전하지 않음
- trait 앞에 unsafe 키워드를 추가하고 그 트레이트의 구현체도 unsafe로 표시함으로써 트레이트가 안전하지 않다고 선언
- unsafe impl 을 사용하면 컴파일러가 확인할 수 없는 불변성은 우리가 지키겠다고 약속을 하는 것

### 유니언 필드에 접근하기
- union은 struct와 유사하지만, 특정 인스턴스에서 한 번에 하나의 선언된 필드만 사용됨
- 유니언은 주로 C 코드의 유니언과 상호작용하는 데 사용됨
- 러스트는 현재 유니언 인스턴스에 저장된 데이터 타입을 보장할 수 없기 때문에, 유니언 필드에 접근하는 것은 안전하지 않음

## 고급 트레이트